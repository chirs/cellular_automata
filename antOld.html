<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Langtons Ant</title>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="verify-v1" content="ES7MT4WW7ZSsA5/BJKdhUjxWnzEkJL8E0UdRHLlL9Yo=" />
  <meta name="description" content="Langton's Ant">

  <link rel="stylesheet" type="text/css" href="style.css" />
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />

  <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>

  <script type="text/javascript" src="ant.js"></script>
  <script type="text/javascript" src="draw.js"></script>


  <script type="text/javascript">
    $(document).ready(function() {
      HEIGHT = 680 
      SCALE = 3; // Zoom is modified by the zoom slider.
      SPEED = 100;

      var intervalID, ant, pattern;
      var running = false;
      var antCanvas = document.getElementById("antBoard");
      var ctx = antCanvas.getContext("2d");
      ctx.save() // Save original transform.

      //   var pattern = "LLRR";

      var redrawBoard = function(){
        var cl = ant.allColors()
        for (var i=0; i < cl.length; i++){
          var coord = cl[i][0]
          var color = cl[i][1]
          fillCoord(ctx, coord, SCALE, color);
        };
      };

      var setZoom = function(){
        var zoom = $("#zoomSlider").slider("value")
        if ( zoom ) {
          SCALE = zoom;
          clearCanvas(antCanvas, ctx);
          redrawBoard();
        }
      };

      var setSpeed = function(){
        var speed = $("#speedSlider").slider("value")
        if ( speed ) {
          SPEED = speed;
        }
      };

      // Move 0,0 from upper-left to center of screen.
      var translateCoord = function(coord){
        var center = HEIGHT / (2 * SCALE)
        return [coord[0] + center, coord[1] + center]
      }


      var antMove = function(){
        for (var i=0; i < SPEED; i++){
          var m = ant.move();
          fillCoord(ctx, m.coord, SCALE, m.color);
        }
      };

      var pause = function(){
        clearInterval(intervalID);
        running = false;
        $("#pause").val("unpause");
      };

      var unPause = function(){
        intervalID = setInterval(antMove, 1);
        running = true;
        $("#pause").val("pause");
      };


      var pauseUnpause = function() { if (running) { pause() } else { unPause() } };
      var getPattern = function(){ return $("#pattern").val() };
      var setPattern = function(val) { $("#pattern").val(val); };

      var start = function() {

        var pattern = getPattern();
        ant = makeAnt(pattern, generateColors(pattern.length));

        //ctx.restore()
        clearCanvas(antCanvas, ctx);
        pause(); // need to balance with unpause to maintain intervalID...fix.
        unPause();
      };


      setPattern(getURLHash(window, "LLRR"));


      // Canvas dragging stuff.

      var isDown = false; // whether mouse is pressed
      var startCoords = []; // 'grab' coordinates when pressing mouse
      var last = [0, 0]; // previous coordinates of mouse release

      antCanvas.onmousedown = function(e) {
        isDown = true;
        startCoords = [
          e.offsetX - last[0], // set start coordinates
          e.offsetY - last[1]
        ];
      };

      antCanvas.onmouseup   = function(e) {
        redrawBoard();
        isDown = false;

        last = [
          e.offsetX - startCoords[0], // set last coordinates
          e.offsetY - startCoords[1]
        ];
      };

      antCanvas.onmousemove = function(e)
      {
        if(!isDown) return; // don't pan if mouse is not pressed

        var x = e.offsetX;
        var y = e.offsetY;

        // set the canvas' transformation matrix by setting the amount of movement:
        // 1  0  dx
        // 0  1  dy
        // 0  0  1

        ctx.setTransform(1, 0, 0, 1,
                         x - startCoords[0], y - startCoords[1]);

        clearCanvas(antCanvas, ctx);
        //render(); // render to show changes

      }

      

      $("#zoomSlider").slider({
        orientation: "vertical", max: 10, min: .1, value: 3, step: .1,
        change: setZoom,
      });
      $("#zoomSlider").height(600);

      $("#speedSlider").slider({
        max: 600, min: 1, value: 100, step: 1,
        change: setSpeed,
      });
      $("#speedSlider").width(600);


      $("#pause").click(pauseUnpause);
      $("#restart").click(start).click();
      $("li>a").click( function() {
        setPattern($(this).html());
        start();
        return;
      })

      //cnvs.click(function(){alert("click"); });
    });
  </script>

</head>


<body class="home">


<div id="speedSlider"></div>
<canvas id="antBoard" width="680" height="680"></canvas>
<div style="display:inline-block" height="680" id="zoomSlider"></div><div id="slider"></div>



<div style="position: fixed; right: 10%; top: 3%;">

<h2><a href="http://en.wikipedia.org/wiki/Langton's_ant">Langton's Ant</a>: a two-dimensional Turing machine</h2>

<div>
  <div><label>pattern</label><input id="pattern" type="input" value="" /></div>
<!--<div><label>speed</label><input id="speed" type="input" value="100" /></div>-->
  <div>
    <input id="restart" type="submit" value="restart" />
    <input id="pause" type="submit" value="pause" />
  </div>
</div>

<ul>
  <li><a href="http://ant.edgemon.org/#LR">LR</a> - the canonical ant, creates a highway.</li>
  <li><a href="http://ant.edgemon.org/#LLRR">LLRR</a> - grows symmetrically</li>
  <li><a href="http://ant.edgemon.org/#LRRRRRLLR">LRRRRRLLR</a> - fills space</li>
  <li><a href="http://ant.edgemon.org/#LLRRR">RRLLLRLLLRRR</a> - sprouts a limb.</li>
</ul>

<ul>
  <li>L - turn left 90 degrees.</li>
  <li>R - turn right 90 degrees.</li>
  <li>S - continue going straight</li>
  <li>V - reverse direction</li>
</ul>
</div>



</body>
